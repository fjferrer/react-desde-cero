<!doctype html>

<title>09 Componentes y Clases - React Desde Cero</title>

<script src="https://unpkg.com/react@16.4.0/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@16.4.0/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/prop-types@15.6.1/prop-types.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script src="https://unpkg.com/create-react-class@15.6.3/create-react-class.js">
// React.createClass fue eliminado de la versión 16 de React
// y por eso debemos cargar su librería de forma independiente
</script>

<div id="app"></div>

<script type="text/babel">
// Frecuentemente un componente necesita mantener un estado `state` interno
// por ejemplo si hay alguna interacción envuelta.
// Los componentes de tipo función, solo pueden mantener propiedades y no ningún estado interno.
// En caso de que un componente tipo función no sea suficiente
// entonces necesitaremos un componente de tipo Clase con una función render
var MyComponent = createReactClass({

  // del mismo modo que en los componentes de tipo función,
  // usamos propTypes para validar el tipo de las propiedades.
  propTypes: {
    color: PropTypes.string,
  },

  // Este método asigna el valor por defecto de las propiedades que faltan.
  // Este método será invocado por React antes de que el componente sea montado en el DOM

  getDefaultProps: function() {
    return {color: "green"}
  },

  // Este método asigna el estado inicial del componente
  // it will be called by React
  // será llamado por React antes de que ningún componente sea montado en el DOM
  // si no es decalarado este método, entonces `this.state` será undefined
  getInitialState: function() {
    // El estado puede ser cualquier valor de JavaScript,
    // pero normalmente es un objecto
    return {times: 0}
  },

  // maneja todos los clicks sobre el elemento span
  handleClick: function() {
    // setState() can be called with an object that contains the new state
    // setState() puede ser llamado con un objeto,
    // el cual será el nuevo valor del estado
    // normally this triggers a call of render(), but React can batch multiple
    // normalmente eso desencadena la llamada a render,
    // pero React puede esperar a acumular varios cambios antes de renderizar
    // lo que hace que la llamada a Render sea asíncrona
    // Por este motivo, setState puede recibir una función callback

    // This can lead to unexpected behaviour, if we rely on this.state or
    // Esto puede conducir a un comportamiento extraño, si confiamos solamente
    // en this.state o this.props para nuestros cálculos
    // this.props for our calculations
    // this.setState({times: this.state.times + 1})
    // this.setState({times: this.state.times + 1})

    // The callback version doesn't have this problem
    // The callback version doesn't have this problem
    // The callback gets the right state and props at time of the update
    // The callback gets the right state and props at time of the update
    this.setState(function(prevState, props) {
      return {times: prevState.times + 1}
    })

  },

  // this method will be called by React
  // this method will be called by React
  // after the component got mounted into the DOM
  // after the component got mounted into the DOM
  // also every time this.setState() was called
  // also every time this.setState() was called
  // it's like the component function from before
  // it's like the component function from before
  // but without a props argument
  // but without a props argument
  render: function() {

    // using the prop given by the creator of this component
    // using the prop given by the creator of this component
    // properties are now in this.props instead of the props argument
    // properties are now in this.props instead of the props argument
    var style = {color: this.props.color}

    // returning an element with a click-handler and the props and
    // returning an element with a click-handler and the props and
    // state values. state is stored in this.state
    // state values. state is stored in this.state
    return (
      <span onClick={this.handleClick} style={style}>
        Clicked {this.state.times} times
      </span>
    )

  },

})

// creating some instances of the interactive stateful component class
// creating some instances of the interactive stateful component class
// one with default color
// one with default color
// Everything works exactly like with the simpler component functions
// Everything works exactly like with the simpler component functions
// The interface has not changed for the user of this component
// The interface has not changed for the user of this component
var reactElement =
  <div>
    <MyComponent color="red"/>
    <br/>
    <MyComponent color="blue"/>
    <br/>
    <MyComponent/>
  </div>;

var renderTarget = document.getElementById("app")

ReactDOM.render(reactElement, renderTarget)
</script>